# pylint: disable=missing-function-docstring, missing-module-docstring, line-too-long, duplicate-code

from . import utils


def test_rt_predict_by_line01(tmp_path):
    image = "registry.spin.nersc.gov/metatlas_test/metatlas_ci02:v1.4.6"
    experiment = "20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583"
    expected = {}
    expected[
        str(tmp_path / experiment / "root0/data_QC/rt_model.txt")
    ] = """RANSACRegressor(random_state=42)
Linear model with intercept=-0.004 and slope=0.99798
groups = 20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583_FPS_MS1_root0_QC, 20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583_POS_MSMS_root0_QC
atlas = HILICz150_ANT20190824_TPL_QCv3_Unlab_POS

LinearRegression()
Polynomial model with intercept=0.097 and coefficents=[0.00000, 0.96116, 0.00213]
groups = 20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583_FPS_MS1_root0_QC, 20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583_POS_MSMS_root0_QC
atlas = HILICz150_ANT20190824_TPL_QCv3_Unlab_POS
"""
    expected[
        str(tmp_path / experiment / "root0/data_QC/RT_Predicted_Model_Comparison.csv")
    ] = """,RT Measured,RT Reference,RT Linear Pred,RT Polynomial Pred,RT Diff Linear,RT Diff Polynomial
0000_4-methoxyphenylacetic_acid_unlabeled_positive_M+H167p0703_1p07,7.757497e-01,1.068942e+00,1.062904e+00,1.126916e+00,-2.871538e-01,-3.511660e-01
0001_nicotinamide_unlabeled_positive_M+H123p0553_1p22,1.249138e+00,1.224396e+00,1.218044e+00,1.277093e+00,3.109441e-02,-2.795476e-02
0002_thymine_unlabeled_positive_M+H127p0502_1p26,1.655354e+00,1.255231e+00,1.248817e+00,1.306894e+00,4.065369e-01,3.484599e-01
0003_benzoic_acid_unlabeled_positive_M+H123p0441_1p27,1.245058e+00,1.272044e+00,1.265596e+00,1.323144e+00,-2.053762e-02,-7.808625e-02
0004_2_4-dihydroxypteridine_unlabeled_positive_M+H165p0407_1p27,,1.272195e+00,1.265746e+00,1.323290e+00,,
0005_uracil_unlabeled_positive_M+H113p0346_1p39,1.884217e+00,1.393700e+00,1.387006e+00,1.440767e+00,4.972116e-01,4.434503e-01
0006_thymidine_unlabeled_positive_M+H243p0975_1p60,1.658310e+00,1.603927e+00,1.596809e+00,1.644175e+00,6.150105e-02,1.413559e-02
0007_2-hydroxyphenylacetic_acid_unlabeled_positive_M+H153p0546_1p62,1.317287e+00,1.616534e+00,1.609391e+00,1.656379e+00,-2.921039e-01,-3.390918e-01
0008_deoxyuridine_unlabeled_positive_M+H229p0819_1p88,1.936198e+00,1.876662e+00,1.868994e+00,1.908343e+00,6.720436e-02,2.785547e-02
0009_acetylcholine_unlabeled_positive_M146p1176_1p96,1.823067e+00,1.955286e+00,1.947459e+00,1.984556e+00,-1.243917e-01,-1.614885e-01
0010_pyridoxine_unlabeled_positive_M+H170p0812_2p16,2.184474e+00,2.158057e+00,2.149820e+00,2.181231e+00,3.465340e-02,3.243017e-03
0011_salicylic_acid_unlabeled_positive_M+H139p0390_2p20,1.828227e+00,2.196355e+00,2.188041e+00,2.218397e+00,-3.598141e-01,-3.901702e-01
0012_2deoxyadenosine_unlabeled_positive_M+H252p1091_2p23,2.293711e+00,2.234007e+00,2.225617e+00,2.254943e+00,6.809390e-02,3.876827e-02
0013_adenine_unlabeled_positive_M+H136p0618_2p56,2.664679e+00,2.557602e+00,2.548559e+00,2.569278e+00,1.161202e-01,9.540118e-02
0014_xanthine_unlabeled_positive_M+H153p0407_2p73,2.770917e+00,2.725344e+00,2.715962e+00,2.732396e+00,5.495467e-02,3.852128e-02
0015_ribose_unlabeled_positive_M+H151p0601_2p75,2.793001e+00,2.750703e+00,2.741270e+00,2.757066e+00,5.173135e-02,3.593541e-02
0016_rhamnose_unlabeled_positive_M+H165p0757_2p80,3.048208e+00,2.796993e+00,2.787467e+00,2.802106e+00,2.607418e-01,2.461023e-01
0017_uridine_unlabeled_positive_M+H245p0768_2p89,2.920205e+00,2.888932e+00,2.879220e+00,2.891589e+00,4.098543e-02,2.861590e-02
0018_adenosine_unlabeled_positive_M+H268p1040_3p09,3.109064e+00,3.091019e+00,3.080899e+00,3.088406e+00,2.816513e-02,2.065825e-02
0019_hypoxanthine_unlabeled_positive_M+H137p0458_3p10,3.143719e+00,3.102967e+00,3.092823e+00,3.100048e+00,5.089525e-02,4.367043e-02
0020_5-methylcytosine_unlabeled_positive_M+H126p0662_4p42,4.466769e+00,4.418372e+00,4.405572e+00,4.385471e+00,6.119677e-02,8.129867e-02
0021_2-oxovaleric_acid_unlabeled_positive_M+H117p0546_4p45,3.964742e+00,4.448129e+00,4.435270e+00,4.414635e+00,-4.705278e-01,-4.498931e-01
0022_cytosine_unlabeled_positive_M+H112p0505_4p83,4.878586e+00,4.833664e+00,4.820026e+00,4.792830e+00,5.855972e-02,8.575598e-02
0023_lactic_acid_unlabeled_positive_M+H91p0390_5p06,5.123689e+00,5.064399e+00,5.050296e+00,5.019476e+00,7.339351e-02,1.042134e-01
0024_inosine_unlabeled_positive_M+H269p0880_5p43,5.435922e+00,5.434236e+00,5.419386e+00,5.383232e+00,1.653554e-02,5.268995e-02
0025_deoxycytidine_unlabeled_positive_M+H228p0979_5p59,5.639834e+00,5.594117e+00,5.578945e+00,5.540665e+00,6.088934e-02,9.916920e-02
0026_nicotinic_acid_unlabeled_positive_M+H124p0393_5p63,5.612481e+00,5.631627e+00,5.616379e+00,5.577616e+00,-3.897145e-03,3.486557e-02
0027_phenylacetic_acid_unlabeled_positive_M+H137p0597_5p88,6.164390e+00,5.878914e+00,5.863166e+00,5.821370e+00,3.012240e-01,3.430198e-01
0028_2_deoxyguanosine_unlabeled_positive_M+H268p1040_6p87,6.953676e+00,6.874187e+00,6.856430e+00,6.805065e+00,9.724509e-02,1.486105e-01
0029_cytidine_unlabeled_positive_M+H244p0928_6p93,6.825944e+00,6.933566e+00,6.915690e+00,6.863887e+00,-8.974598e-02,-3.794316e-02
0030_N-acetyl-mannosamine_unlabeled_positive_M+Na244p0792_7p15,6.662416e+00,7.153497e+00,7.135177e+00,7.081885e+00,-4.727614e-01,-4.194697e-01
0031_betaine_unlabeled_positive_M118p0863_7p91,8.033511e+00,7.905109e+00,7.885272e+00,7.828449e+00,1.482395e-01,2.050618e-01
0032_guanosine_unlabeled_positive_M+H284p0989_8p57,8.483605e+00,8.570945e+00,8.549763e+00,8.491826e+00,-6.615764e-02,-8.220596e-03
0033_phenylalanine_unlabeled_positive_M+H166p0863_8p98,9.091378e+00,8.979306e+00,8.957300e+00,8.899615e+00,1.340779e-01,1.917629e-01
0034_leucine_unlabeled_positive_M+H132p1019_9p32,9.326713e+00,9.319656e+00,9.296963e+00,9.240032e+00,2.974915e-02,8.668057e-02
0035_urocanic_acid_unlabeled_positive_M+H139p0502_9p35,8.878216e+00,9.351932e+00,9.329174e+00,9.272340e+00,-4.509584e-01,-3.941241e-01
0036_mannitol_unlabeled_positive_M+H183p0863_9p53,9.116773e+00,9.534507e+00,9.511381e+00,9.455179e+00,-3.946074e-01,-3.384061e-01
0037_isoleucine_unlabeled_positive_M+H132p1019_9p71,9.326713e+00,9.705437e+00,9.681966e+00,9.626486e+00,-3.552533e-01,-2.997735e-01
0038_xanthosine_unlabeled_positive_M+H285p0830_9p78,9.507514e+00,9.782679e+00,9.759051e+00,9.703939e+00,-2.515374e-01,-1.964246e-01
0039_tryptophan_unlabeled_positive_M+H205p0972_10p16,1.033726e+01,1.015665e+01,1.013227e+01,1.007929e+01,2.049939e-01,2.579701e-01
0040_methionine_unlabeled_positive_M+H150p0583_10p44,1.045663e+01,1.044096e+01,1.041600e+01,1.036505e+01,4.063254e-02,9.158536e-02
0041_1-methyladenosine_unlabeled_positive_M+H282p1197_10p78,1.104278e+01,1.078125e+01,1.075560e+01,1.070753e+01,2.871788e-01,3.352563e-01
0042_proline_unlabeled_positive_M+H116p0706_10p92,1.084986e+01,1.091977e+01,1.089385e+01,1.084708e+01,-4.398391e-02,2.781717e-03
0043_pipecolic_acid_unlabeled_positive_M+H130p0863_10p97,1.099178e+01,1.097482e+01,1.094879e+01,1.090257e+01,4.299669e-02,8.921823e-02
0044_valine_unlabeled_positive_M+H118p0863_11p12,1.104128e+01,1.111601e+01,1.108969e+01,1.104492e+01,-4.841516e-02,-3.648160e-03
0045_5-oxo-proline_unlabeled_positive_M+H130p0499_11p65,1.150428e+01,1.165331e+01,1.162590e+01,1.158745e+01,-1.216285e-01,-8.317446e-02
0046_taurine_unlabeled_positive_M+H126p0219_12p16,1.207540e+01,1.215812e+01,1.212970e+01,1.209830e+01,-5.430582e-02,-2.290514e-02
0047_ectoine_unlabeled_positive_M+H143p0815_12p50,1.236879e+01,1.250350e+01,1.247438e+01,1.244843e+01,-1.055899e-01,-7.964115e-02
0048_carnitine_unlabeled_positive_M+H161p1046_13p29,1.346691e+01,1.328583e+01,1.325513e+01,1.324341e+01,2.117815e-01,2.234988e-01
0049_alanine_unlabeled_positive_M+H90p0550_13p41,1.368701e+01,1.340509e+01,1.337415e+01,1.336483e+01,3.128634e-01,3.221819e-01
0050_sucrose_unlabeled_positive_M+H343p1235_13p45,1.332883e+01,1.344515e+01,1.341413e+01,1.340563e+01,-8.529863e-02,-7.679955e-02
0051_threonine_unlabeled_positive_M+H120p0655_13p49,1.345966e+01,1.348957e+01,1.345846e+01,1.345088e+01,1.195075e-03,8.777556e-03
0052_cis-4-hydroxy-proline_unlabeled_positive_M+H132p0655_13p67,1.324374e+01,1.367383e+01,1.364235e+01,1.363866e+01,-3.986126e-01,-3.949220e-01
0053_4-guanidinobutanoic_acid_unlabeled_positive_M+H146p0924_13p86,1.388631e+01,1.386132e+01,1.382946e+01,1.382988e+01,5.684784e-02,5.642956e-02
0054_maltose_unlabeled_positive_M+Na365p1054_14p07,1.366329e+01,1.406778e+01,1.403550e+01,1.404062e+01,-3.722052e-01,-3.773214e-01
0055_serine_unlabeled_positive_M+H106p0499_14p31,1.432834e+01,1.431261e+01,1.427984e+01,1.429077e+01,4.849323e-02,3.757009e-02
0056_glutamine_unlabeled_positive_M+H147p0764_14p31,1.432055e+01,1.431276e+01,1.427999e+01,1.429091e+01,4.056304e-02,2.963639e-02
0057_asparagine_unlabeled_positive_M+H133p0608_14p37,1.436048e+01,1.436809e+01,1.433521e+01,1.434748e+01,2.527248e-02,1.299805e-02
0058_gamma-Aminobutyric_acid_unlabeled_positive_M+H104p0706_14p39,1.439244e+01,1.438565e+01,1.435273e+01,1.436544e+01,3.970288e-02,2.699790e-02
0059_alpha-ketoglutaric_acid_unlabeled_positive_M+H147p0288_14p51,,1.450646e+01,1.447330e+01,1.448900e+01,,
0060_mannosamine_unlabeled_positive_M+H180p0866_14p52,1.469622e+01,1.452081e+01,1.448762e+01,1.450368e+01,2.086006e-01,1.925382e-01
0061_cysteic_acid_unlabeled_positive_M+H170p0118_14p54,1.455917e+01,1.453906e+01,1.450583e+01,1.452236e+01,5.333597e-02,3.681431e-02
0062_N-acetyl-aspartic_acid_unlabeled_positive_M+H176p0553_14p82,1.463486e+01,1.482465e+01,1.479084e+01,1.481474e+01,-1.559830e-01,-1.798770e-01
0063_citrulline_unlabeled_positive_M+H176p1030_15p09,1.514158e+01,1.508943e+01,1.505509e+01,1.508613e+01,8.649102e-02,5.545072e-02
0064_N-alpha-acetyl-lysine_unlabeled_positive_M+H189p1234_15p13,1.519049e+01,1.512986e+01,1.509544e+01,1.512760e+01,9.504756e-02,6.288975e-02
0065_N-acetyl-glutamic_acid_unlabeled_positive_M+H190p0710_15p16,1.511882e+01,1.515757e+01,1.512310e+01,1.515602e+01,-4.271905e-03,-3.719969e-02
0066_raffinose_unlabeled_positive_M+H505p1763_15p53,1.554399e+01,1.553250e+01,1.549726e+01,1.554093e+01,4.672360e-02,3.056330e-03
0067_glutamic_acid_unlabeled_positive_M+H148p0604_15p94,1.600693e+01,1.593539e+01,1.589934e+01,1.595522e+01,1.075880e-01,5.171177e-02
0068_Aspartic_acid_unlabeled_positive_M+H134p0448_16p13,1.624087e+01,1.613036e+01,1.609392e+01,1.615595e+01,1.469493e-01,8.491622e-02
0069_arginine_unlabeled_positive_M+H175p1190_16p94,1.697641e+01,1.693992e+01,1.690184e+01,1.699117e+01,7.457421e-02,-1.475809e-02
0070_lysine_unlabeled_positive_M+H147p1128_17p01,1.704841e+01,1.701131e+01,1.697309e+01,1.706497e+01,7.531618e-02,-1.655780e-02
0071_ornithine_unlabeled_positive_M+H133p0972_17p04,1.707057e+01,1.703725e+01,1.699898e+01,1.709178e+01,7.159456e-02,-2.120829e-02"""

    expected[
        str(tmp_path / experiment / "root0/data_QC/QC_Measured_RTs.csv")
    ] = """,20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583_FPS_MS1_0_QC_Pre_Rg70to1050-CE102040--QC_Run6.h5,20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583_POS_MSMS_0_QC_Pre_Rg70to1050-CE102040--QC_Run7.h5,20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583_FPS_MS1_0_QC_Post_Rg70to1050-CE102040--QC_Run307.h5,20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583_POS_MSMS_0_QC_Post_Rg70to1050-CE102040--QC_Run308.h5,mean,median,min,max,standard deviation,standard error,#NaNs
0000_4-methoxyphenylacetic_acid_unlabeled_positive_M+H167p0703_1p07,7.608836e-01,7.883098e-01,7.816192e-01,7.698803e-01,7.751732e-01,7.757497e-01,7.608836e-01,7.883098e-01,1.219738e-02,6.098689e-03,0
0001_nicotinamide_unlabeled_positive_M+H123p0553_1p22,1.234081e+00,1.247221e+00,1.251056e+00,1.254431e+00,1.246697e+00,1.249138e+00,1.234081e+00,1.254431e+00,8.911895e-03,4.455948e-03,0
0002_thymine_unlabeled_positive_M+H127p0502_1p26,1.646053e+00,1.656285e+00,1.662199e+00,1.654422e+00,1.654740e+00,1.655354e+00,1.646053e+00,1.662199e+00,6.673064e-03,3.336532e-03,0
0003_benzoic_acid_unlabeled_positive_M+H123p0441_1p27,1.646053e+00,7.727391e-01,1.712503e+00,8.440630e-01,1.243839e+00,1.245058e+00,7.727391e-01,1.712503e+00,5.043733e-01,2.521867e-01,0
0004_2_4-dihydroxypteridine_unlabeled_positive_M+H165p0407_1p27,,,,,,,,,,,0
0005_uracil_unlabeled_positive_M+H113p0346_1p39,1.879153e+00,1.889282e+00,1.878133e+00,1.892506e+00,1.884768e+00,1.884217e+00,1.878133e+00,1.892506e+00,7.206614e-03,3.603307e-03,0
0006_thymidine_unlabeled_positive_M+H243p0975_1p60,1.646053e+00,1.667212e+00,1.662199e+00,1.654422e+00,1.657471e+00,1.658310e+00,1.646053e+00,1.667212e+00,9.254048e-03,4.627024e-03,0
0007_2-hydroxyphenylacetic_acid_unlabeled_positive_M+H153p0546_1p62,1.424544e+00,1.210030e+00,1.662199e+00,1.187282e+00,1.371013e+00,1.317287e+00,1.187282e+00,1.662199e+00,2.216058e-01,1.108029e-01,0
0008_deoxyuridine_unlabeled_positive_M+H229p0819_1p88,1.940126e+00,1.949231e+00,1.910658e+00,1.932271e+00,1.933071e+00,1.936198e+00,1.910658e+00,1.949231e+00,1.647145e-02,8.235723e-03,0
0009_acetylcholine_unlabeled_positive_M146p1176_1p96,1.801525e+00,1.771603e+00,1.844610e+00,1.857167e+00,1.818726e+00,1.823067e+00,1.771603e+00,1.857167e+00,3.942978e-02,1.971489e-02,0
0010_pyridoxine_unlabeled_positive_M+H170p0812_2p16,2.140231e+00,2.159749e+00,2.209199e+00,2.223219e+00,2.183099e+00,2.184474e+00,2.140231e+00,2.223219e+00,3.947044e-02,1.973522e-02,0
0011_salicylic_acid_unlabeled_positive_M+H139p0390_2p20,,1.841401e+00,1.828227e+00,1.780671e+00,1.816766e+00,1.828227e+00,1.780671e+00,1.841401e+00,3.194554e-02,1.844377e-02,0
0012_2deoxyadenosine_unlabeled_positive_M+H252p1091_2p23,2.247590e+00,2.275779e+00,2.322836e+00,2.311643e+00,2.289462e+00,2.293711e+00,2.247590e+00,2.322836e+00,3.438155e-02,1.719078e-02,0
0013_adenine_unlabeled_positive_M+H136p0618_2p56,2.593030e+00,2.625245e+00,2.704113e+00,2.719899e+00,2.660572e+00,2.664679e+00,2.593030e+00,2.719899e+00,6.117022e-02,3.058511e-02,0
0014_xanthine_unlabeled_positive_M+H153p0407_2p73,2.747974e+00,2.775257e+00,2.766577e+00,2.788285e+00,2.769523e+00,2.770917e+00,2.747974e+00,2.788285e+00,1.691088e-02,8.455441e-03,0
0015_ribose_unlabeled_positive_M+H151p0601_2p75,2.763174e+00,2.769817e+00,2.835043e+00,2.816185e+00,2.796055e+00,2.793001e+00,2.763174e+00,2.835043e+00,3.509440e-02,1.754720e-02,0
0016_rhamnose_unlabeled_positive_M+H165p0757_2p80,3.136334e+00,2.960083e+00,,,3.048208e+00,3.048208e+00,2.960083e+00,3.136334e+00,1.246286e-01,8.812571e-02,0
0017_uridine_unlabeled_positive_M+H245p0768_2p89,2.919913e+00,2.943791e+00,2.917609e+00,2.920497e+00,2.925453e+00,2.920205e+00,2.917609e+00,2.943791e+00,1.228923e-02,6.144614e-03,0
0018_adenosine_unlabeled_positive_M+H268p1040_3p09,3.075452e+00,3.078128e+00,3.146962e+00,3.140000e+00,3.110135e+00,3.109064e+00,3.075452e+00,3.146962e+00,3.862430e-02,1.931215e-02,0
0019_hypoxanthine_unlabeled_positive_M+H137p0458_3p10,3.136334e+00,3.140476e+00,3.146962e+00,3.161954e+00,3.146431e+00,3.143719e+00,3.136334e+00,3.161954e+00,1.123472e-02,5.617358e-03,0
0020_5-methylcytosine_unlabeled_positive_M+H126p0662_4p42,4.396528e+00,4.399042e+00,4.534496e+00,4.545422e+00,4.468872e+00,4.466769e+00,4.396528e+00,4.545422e+00,8.221156e-02,4.110578e-02,0
0021_2-oxovaleric_acid_unlabeled_positive_M+H117p0546_4p45,,,,3.964742e+00,3.964742e+00,3.964742e+00,3.964742e+00,3.964742e+00,,,0
0022_cytosine_unlabeled_positive_M+H112p0505_4p83,4.836015e+00,4.846456e+00,4.910717e+00,4.921309e+00,4.878624e+00,4.878586e+00,4.836015e+00,4.921309e+00,4.359777e-02,2.179888e-02,0
0023_lactic_acid_unlabeled_positive_M+H91p0390_5p06,,5.123689e+00,,,5.123689e+00,5.123689e+00,5.123689e+00,5.123689e+00,,,0
0024_inosine_unlabeled_positive_M+H269p0880_5p43,5.432004e+00,5.439839e+00,5.391832e+00,5.441697e+00,5.426343e+00,5.435922e+00,5.391832e+00,5.441697e+00,2.338750e-02,1.169375e-02,0
0025_deoxycytidine_unlabeled_positive_M+H228p0979_5p59,5.601799e+00,5.607846e+00,5.671822e+00,5.671968e+00,5.638359e+00,5.639834e+00,5.601799e+00,5.671968e+00,3.880306e-02,1.940153e-02,0
0026_nicotinic_acid_unlabeled_positive_M+H124p0393_5p63,5.478054e+00,5.553141e+00,5.671822e+00,5.700731e+00,5.600937e+00,5.612481e+00,5.478054e+00,5.700731e+00,1.038720e-01,5.193602e-02,0
0027_phenylacetic_acid_unlabeled_positive_M+H137p0597_5p88,,6.089039e+00,6.223823e+00,6.164390e+00,6.159084e+00,6.164390e+00,6.089039e+00,6.223823e+00,6.754837e-02,3.899907e-02,0
0028_2_deoxyguanosine_unlabeled_positive_M+H268p1040_6p87,6.925776e+00,6.942815e+00,6.964536e+00,6.967518e+00,6.950161e+00,6.953676e+00,6.925776e+00,6.967518e+00,1.963450e-02,9.817249e-03,0
0029_cytidine_unlabeled_positive_M+H244p0928_6p93,6.802322e+00,6.832951e+00,6.818937e+00,6.858342e+00,6.828138e+00,6.825944e+00,6.802322e+00,6.858342e+00,2.371021e-02,1.185511e-02,0
0030_N-acetyl-mannosamine_unlabeled_positive_M+Na244p0792_7p15,6.656971e+00,6.657993e+00,6.666838e+00,6.696530e+00,6.669583e+00,6.662416e+00,6.656971e+00,6.696530e+00,1.850284e-02,9.251420e-03,0
0031_betaine_unlabeled_positive_M118p0863_7p91,7.914711e+00,7.898167e+00,8.152311e+00,8.210945e+00,8.044034e+00,8.033511e+00,7.898167e+00,8.210945e+00,1.608157e-01,8.040783e-02,0
0032_guanosine_unlabeled_positive_M+H284p0989_8p57,8.490147e+00,8.500515e+00,8.451272e+00,8.477064e+00,8.479749e+00,8.483605e+00,8.451272e+00,8.500515e+00,2.127192e-02,1.063596e-02,0
0033_phenylalanine_unlabeled_positive_M+H166p0863_8p98,9.065049e+00,9.064213e+00,9.132003e+00,9.117706e+00,9.094743e+00,9.091378e+00,9.064213e+00,9.132003e+00,3.525821e-02,1.762911e-02,0
0034_leucine_unlabeled_positive_M+H132p1019_9p32,9.267673e+00,9.295422e+00,9.358004e+00,9.375864e+00,9.324240e+00,9.326713e+00,9.267673e+00,9.375864e+00,5.110577e-02,2.555289e-02,0
0035_urocanic_acid_unlabeled_positive_M+H139p0502_9p35,8.894340e+00,8.865837e+00,8.890594e+00,8.856620e+00,8.876848e+00,8.878216e+00,8.856620e+00,8.894340e+00,1.848729e-02,9.243643e-03,0
0036_mannitol_unlabeled_positive_M+H183p0863_9p53,9.065049e+00,9.164083e+00,9.148657e+00,9.084889e+00,9.115670e+00,9.116773e+00,9.065049e+00,9.164083e+00,4.810374e-02,2.405187e-02,0
0037_isoleucine_unlabeled_positive_M+H132p1019_9p71,9.267673e+00,9.295422e+00,9.358004e+00,9.375864e+00,9.324240e+00,9.326713e+00,9.267673e+00,9.375864e+00,5.110577e-02,2.555289e-02,0
0038_xanthosine_unlabeled_positive_M+H285p0830_9p78,9.526046e+00,9.489383e+00,9.510781e+00,9.504247e+00,9.507614e+00,9.507514e+00,9.489383e+00,9.526046e+00,1.520395e-02,7.601975e-03,0
0039_tryptophan_unlabeled_positive_M+H205p0972_10p16,1.033144e+01,1.032778e+01,1.034727e+01,1.034308e+01,1.033739e+01,1.033726e+01,1.032778e+01,1.034727e+01,9.266094e-03,4.633047e-03,0
0040_methionine_unlabeled_positive_M+H150p0583_10p44,1.044385e+01,1.043935e+01,1.046941e+01,1.047429e+01,1.045672e+01,1.045663e+01,1.043935e+01,1.047429e+01,1.767370e-02,8.836851e-03,0
0041_1-methyladenosine_unlabeled_positive_M+H282p1197_10p78,1.105067e+01,1.103490e+01,,,1.104278e+01,1.104278e+01,1.103490e+01,1.105067e+01,1.114902e-02,7.883549e-03,0
0042_proline_unlabeled_positive_M+H116p0706_10p92,1.082799e+01,1.080601e+01,1.087174e+01,1.088702e+01,1.084819e+01,1.084986e+01,1.080601e+01,1.088702e+01,3.763473e-02,1.881736e-02,0
0043_pipecolic_acid_unlabeled_positive_M+H130p0863_10p97,1.095587e+01,1.094364e+01,1.102770e+01,1.104769e+01,1.099372e+01,1.099178e+01,1.094364e+01,1.104769e+01,5.166481e-02,2.583240e-02,0
0044_valine_unlabeled_positive_M+H118p0863_11p12,1.103486e+01,1.101226e+01,1.106115e+01,1.104769e+01,1.103899e+01,1.104128e+01,1.101226e+01,1.106115e+01,2.079988e-02,1.039994e-02,0
0045_5-oxo-proline_unlabeled_positive_M+H130p0499_11p65,1.149909e+01,1.150808e+01,1.150047e+01,1.151047e+01,1.150453e+01,1.150428e+01,1.149909e+01,1.151047e+01,5.594589e-03,2.797295e-03,0
0046_taurine_unlabeled_positive_M+H126p0219_12p16,1.210450e+01,1.210157e+01,1.204528e+01,1.204922e+01,1.207514e+01,1.207540e+01,1.204528e+01,1.210450e+01,3.226741e-02,1.613371e-02,0
0047_ectoine_unlabeled_positive_M+H143p0815_12p50,1.229384e+01,1.227891e+01,1.245509e+01,1.244374e+01,1.236789e+01,1.236879e+01,1.227891e+01,1.245509e+01,9.444225e-02,4.722113e-02,0
0048_carnitine_unlabeled_positive_M+H161p1046_13p29,,1.335510e+01,,1.357872e+01,1.346691e+01,1.346691e+01,1.335510e+01,1.357872e+01,1.581269e-01,1.118126e-01,0
0049_alanine_unlabeled_positive_M+H90p0550_13p41,,1.368701e+01,,,1.368701e+01,1.368701e+01,1.368701e+01,1.368701e+01,,,0
0050_sucrose_unlabeled_positive_M+H343p1235_13p45,,,1.334303e+01,1.331463e+01,1.332883e+01,1.332883e+01,1.331463e+01,1.334303e+01,2.008078e-02,1.419926e-02,0
0051_threonine_unlabeled_positive_M+H120p0655_13p49,1.346224e+01,1.345579e+01,1.345708e+01,1.346524e+01,1.346009e+01,1.345966e+01,1.345579e+01,1.346524e+01,4.423994e-03,2.211997e-03,0
0052_cis-4-hydroxy-proline_unlabeled_positive_M+H132p0655_13p67,1.322753e+01,1.322201e+01,1.325995e+01,1.327736e+01,1.324671e+01,1.324374e+01,1.322201e+01,1.327736e+01,2.641386e-02,1.320693e-02,0
0053_4-guanidinobutanoic_acid_unlabeled_positive_M+H146p0924_13p86,1.385556e+01,1.386021e+01,1.391799e+01,1.391241e+01,1.388654e+01,1.388631e+01,1.385556e+01,1.391799e+01,3.322648e-02,1.661324e-02,0
0054_maltose_unlabeled_positive_M+Na365p1054_14p07,1.365063e+01,1.367596e+01,1.363805e+01,1.397811e+01,1.373569e+01,1.366329e+01,1.363805e+01,1.397811e+01,1.623827e-01,8.119134e-02,0
0055_serine_unlabeled_positive_M+H106p0499_14p31,1.432981e+01,1.433325e+01,1.432686e+01,1.432437e+01,1.432857e+01,1.432834e+01,1.432437e+01,1.433325e+01,3.833052e-03,1.916526e-03,0
0056_glutamine_unlabeled_positive_M+H147p0764_14p31,1.431424e+01,1.430630e+01,1.432686e+01,1.433612e+01,1.432088e+01,1.432055e+01,1.430630e+01,1.433612e+01,1.322557e-02,6.612787e-03,0
0057_asparagine_unlabeled_positive_M+H133p0608_14p37,1.436136e+01,1.435567e+01,1.435959e+01,1.437167e+01,1.436207e+01,1.436048e+01,1.435567e+01,1.437167e+01,6.824157e-03,3.412078e-03,0
0058_gamma-Aminobutyric_acid_unlabeled_positive_M+H104p0706_14p39,1.437687e+01,1.436686e+01,1.440800e+01,1.441325e+01,1.439125e+01,1.439244e+01,1.436686e+01,1.441325e+01,2.285227e-02,1.142613e-02,0
0059_alpha-ketoglutaric_acid_unlabeled_positive_M+H147p0288_14p51,,,,,,,,,,,0
0060_mannosamine_unlabeled_positive_M+H180p0866_14p52,1.470493e+01,1.471265e+01,1.468316e+01,1.468752e+01,1.469706e+01,1.469622e+01,1.468316e+01,1.471265e+01,1.401184e-02,7.005919e-03,0
0061_cysteic_acid_unlabeled_positive_M+H170p0118_14p54,1.457987e+01,1.458408e+01,1.453791e+01,1.453847e+01,1.456008e+01,1.455917e+01,1.453791e+01,1.458408e+01,2.534308e-02,1.267154e-02,0
0062_N-acetyl-aspartic_acid_unlabeled_positive_M+H176p0553_14p82,,1.456199e+01,1.463486e+01,1.469942e+01,1.463209e+01,1.463486e+01,1.456199e+01,1.469942e+01,6.875457e-02,3.969547e-02,0
0063_citrulline_unlabeled_positive_M+H176p1030_15p09,1.512858e+01,1.512829e+01,1.515458e+01,1.516279e+01,1.514356e+01,1.514158e+01,1.512829e+01,1.516279e+01,1.778317e-02,8.891585e-03,0
0064_N-alpha-acetyl-lysine_unlabeled_positive_M+H189p1234_15p13,1.515950e+01,1.516161e+01,1.521937e+01,1.522329e+01,1.519094e+01,1.519049e+01,1.515950e+01,1.522329e+01,3.513764e-02,1.756882e-02,0
0065_N-acetyl-glutamic_acid_unlabeled_positive_M+H190p0710_15p16,1.514407e+01,1.512829e+01,1.510584e+01,1.510936e+01,1.512189e+01,1.511882e+01,1.510584e+01,1.514407e+01,1.777523e-02,8.887613e-03,0
0066_raffinose_unlabeled_positive_M+H505p1763_15p53,1.555501e+01,1.555573e+01,1.551640e+01,1.553297e+01,1.554003e+01,1.554399e+01,1.551640e+01,1.555573e+01,1.896500e-02,9.482499e-03,0
0067_glutamic_acid_unlabeled_positive_M+H148p0604_15p94,1.600358e+01,1.601288e+01,1.600018e+01,1.601028e+01,1.600673e+01,1.600693e+01,1.600018e+01,1.601288e+01,5.867143e-03,2.933571e-03,0
0068_Aspartic_acid_unlabeled_positive_M+H134p0448_16p13,1.624536e+01,1.624424e+01,1.623356e+01,1.623750e+01,1.624016e+01,1.624087e+01,1.623356e+01,1.624536e+01,5.607905e-03,2.803953e-03,0
0069_arginine_unlabeled_positive_M+H175p1190_16p94,1.696392e+01,1.696169e+01,1.698891e+01,1.699182e+01,1.697658e+01,1.697641e+01,1.696169e+01,1.699182e+01,1.598444e-02,7.992220e-03,0
0070_lysine_unlabeled_positive_M+H147p1128_17p01,1.704321e+01,1.703506e+01,1.705360e+01,1.705996e+01,1.704796e+01,1.704841e+01,1.703506e+01,1.705996e+01,1.102419e-02,5.512097e-03,0
0071_ornithine_unlabeled_positive_M+H133p0972_17p04,1.705887e+01,1.706319e+01,1.708551e+01,1.707796e+01,1.707138e+01,1.707057e+01,1.705887e+01,1.708551e+01,1.246700e-02,6.233499e-03,0"""

    command = """\
                    jq -M '(.cells[] | select(.source[] | contains("predict_rt.generate_outputs(")).source) \
                                = ["predict_rt.generate_outputs(ids, max_cpus, metatlas_repo_path, save_to_db=False, model_only=True)"]' \
                                /src/notebooks/reference/RT_Prediction.ipynb > /out/Remove.ipynb &&  \
                    papermill \
                        -p source_atlas HILICz150_ANT20190824_PRD_EMA_Unlab_POS_20201106_505892_root0 \
                        -p experiment 20201106_JGI-AK_PS-KM_505892_OakGall_final_QE-HF_HILICZ_USHXG01583 \
                        -p metatlas_repo_path /src \
                        -p project_directory /out \
                        -p max_cpus 2 \
                        /out/Remove.ipynb \
                        /out/Remove-done.ipynb
                   """
    utils.exec_docker(image, command, tmp_path)
    assert utils.num_files_in(tmp_path) == 9
    utils.assert_files_match(expected)
